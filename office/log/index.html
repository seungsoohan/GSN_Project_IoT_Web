<!DOCTYPE html>
<html lang="en" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>Device LOG</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.22.2/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.min.js" charset="utf-8"></script>


  </head>
  <body>
    <canvas id="myChart" width="400" height="400"></canvas>

  </body>
</html>

<script>

let dataNums = new window.URLSearchParams(window.location.search).get("n");

dataNums = parseInt(dataNums);
if(dataNums == null || dataNums == 0 || dataNums == "" || isNaN(dataNums)) {
  dataNums = 100;
  console.log("parameter error");
}
// console.log(dataNums);
$.ajax({
      url: "https://93sqldop2g.execute-api.ap-northeast-2.amazonaws.com/v1/device/log?n=" + dataNums,
      cache: false
    })
      .done(function(data, textStatus, jqXHR) {
        // $("#content").html(data);
        console.log(data)
        let logData = data.data;
        let parsePIRData = [];
        let parseSoundData = [];
        // logData.forEach
        logData.forEach(function(el) {
          let temp = new Object()
          temp.x = new Date(el.datetime);
          // temp.x = "2018-01-22T04:57:43";
          // temp.x = "Wed Dec 16 2020 16:51:46 GMT+0900";
          if(el.type == 1) {
            temp.y = el.count;
            parsePIRData.push(temp);
          }
          else if(el.type == 2) {
            temp.y = el.count;
            parseSoundData.push(temp);
            // console.log(temp);
          }

          // parseData.push(temp);
        });
        // console.log(temp);
        console.log(parseSoundData);
        var ctx = document.getElementById('myChart').getContext('2d');
        // ctx.height = 100;
        var myChart = new Chart(ctx, {
            type: 'line',
            data: {
                // labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
                datasets: [
                  {
                    label: 'PIR',
                    data: parsePIRData,
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.2)',
                        // 'rgba(54, 162, 235, 0.2)',
                        // 'rgba(255, 206, 86, 0.2)',
                        // 'rgba(75, 192, 192, 0.2)',
                        // 'rgba(153, 102, 255, 0.2)',

                    ],
                    borderColor: [
                        'rgba(255, 99, 132, 1)',
                        // 'rgba(54, 162, 235, 1)',
                        // 'rgba(255, 206, 86, 1)',
                        // 'rgba(75, 192, 192, 1)',
                        // 'rgba(153, 102, 255, 1)',
                        // 'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                },
                {
                    label: 'Sound',
                    data: parseSoundData,
                    backgroundColor: [
                        // 'rgba(255, 99, 132, 0.2)',
                        'rgba(54, 162, 235, 0.2)',
                        // 'rgba(255, 206, 86, 0.2)',
                        // 'rgba(75, 192, 192, 0.2)',
                        // 'rgba(153, 102, 255, 0.2)',
                        // 'rgba(54, 162, 235, 1)',

                    ],
                    borderColor: [
                        // 'rgba(255, 99, 132, 1)',
                        'rgba(54, 162, 235, 1)',
                        // 'rgba(255, 206, 86, 1)',
                        // 'rgba(75, 192, 192, 1)',
                        // 'rgba(153, 102, 255, 1)',
                        // 'rgba(255, 159, 64, 1)'
                    ],
                    borderWidth: 1
                },
              ]
            },
            options: {
              maintainAspectRatio: false,
              scales: {
                xAxes: [{
                  type: 'time'
                }],
                yAxes: [{
                    scaleLabel: {
                      display: true,
                      labelString: 'Activity State',
                    },
                    ticks: {
                      min: 0,
                      max: 6,
                      stepSize: 1,
                    },
                  }]
              }
            }
            // options: {
            //   scales: {
            //     xAxes: [{
            //       type: 'time',
            //       time: {
            //         unit: 'minute',
            //         displayFormats: {
            //           minute: 'lll',
            //         },
            //         tooltipFormat: 'lll',
            //       },
            //       scaleLabel: {
            //         display: true,
            //         labelString: 'Time',
            //       }
            //     }],
            //     yAxes: [{
            //       scaleLabel: {
            //         display: true,
            //         labelString: 'Activity State',
            //       },
            //       ticks: {
            //         min: 0,
            //         max: 3,
            //         stepSize: 1,
            //       },
            //     }]
            //   }
            // }
        });
      })
      .fail(function(jqXHR, textStatus, errorThrown){
        console.log("fail: ", jqXHR);
      })
      .always(function(data, textStatus, jqXHR){
        // console.log("always: ", data);
      });
// https://93sqldop2g.execute-api.ap-northeast-2.amazonaws.com/v1/device/log

</script>
